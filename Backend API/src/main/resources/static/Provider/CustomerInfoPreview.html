<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/Home.css">
    <link rel="stylesheet" href="/Customer/CustomerProfile.css">
    <title>Home Page</title>
</head>

<body>
    <div id="header">
    <img src="/images2/Logo_Company.png" alt="Company Logo" id="company-logo">

        <div class="header-btn-group">
            <button id="logout-btn" onclick="location.href='/LogIn.html'" aria-label="Logout">
                <span class="logout-icon">ðŸ”’</span>
                <span class="logout-text">Logout</span>
            </button>
            <button id="profile-btn" onclick="location.href='PProfile.html'" aria-label="Profile">
                <span class="profile-icon">ðŸ‘¤</span>
                <span class="profile-text">Profile</span>
            </button>
        </div>
    </div>
    <div id="home-container">
        <hr>
         <div id="navigationMenu">
        <button onclick="location.href='Home.html'" class="navButton">Home</button>
        <button onclick="location.href='PServices.html'" class="navButton">Services</button>
        <button onclick="location.href='CustomerInfo.html'" class="navButton">Customer Info</button>
        <button onclick="location.href='Reviews.html'" class="navButton">Reviews</button>
        </div>
        <hr>
        <div id="Customer-Info-Section">
            <!-- Dynamic customer list will be rendered here -->
            <div id="customers-placeholder" class="info-box" style="text-align:center;">
                <h2>Loading customersâ€¦</h2>
            </div>
        </div>
    </div>
    <!-- add scripts and choose behavior based on presence of an `id` query param -->
    <script src="/Customer/customer-account.js"></script>
    <script src="/Provider/provider-customers.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            try{
                const url = new URL(location.href);
                const id = url.searchParams.get('id');
                if (id) {
                    // If id is present, fetch that customer and render in read-only mode
                    const profileContainer = document.querySelector('#Customer-Info-Section .info-box');
                    if (profileContainer && window.renderCustomerProfile) {
                        (async () => {
                            try {
                                const res = await fetch(`${window.location.origin}/api/customers/${encodeURIComponent(id)}`);
                                if (!res.ok) {
                                    profileContainer.innerHTML = `<h2>Error</h2><p>Could not load profile (${res.status})</p>`;
                                    return;
                                }
                                const customer = await res.json();
                                // Explicitly render as not-owned (read-only) for providers
                                window.renderCustomerProfile(profileContainer, customer, false);
                                // Override the "Back to Home" button to go to the Provider home page
                                try {
                                    const btns = profileContainer.querySelectorAll('button');
                                    for (const b of btns) {
                                        if (b.textContent && b.textContent.trim().toLowerCase().startsWith('back')) {
                                            b.onclick = () => { location.href = '/Provider/Home.html'; };
                                            break;
                                        }
                                    }
                                } catch (err) {
                                    console.warn('Could not adjust back button for provider preview:', err);
                                }
                            } catch (err) {
                                profileContainer.innerHTML = `<h2>Error</h2><p>Network error while loading profile.</p>`;
                                console.error('Error loading customer profile (preview):', err);
                            }
                        })();
                    } else if (window.loadCustomerProfile) {
                        // Fallback to existing loader
                        window.loadCustomerProfile();
                    }
                } else {
                    // Otherwise show the provider customer list
                    if (window.loadProviderCustomers) window.loadProviderCustomers();
                }
            }catch(e){
                // fallback: show the list
                if(window.loadProviderCustomers) window.loadProviderCustomers();
            }
        });
    </script>
</body>

</html>