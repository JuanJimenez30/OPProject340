<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/Login.css">
    <title>Log In</title>
</head>
<body>
      
    <div id="login-container">
    <!-- <h1>Log In </h1> -->
    <form id="loginForm" action="#" >
        <h1>Log In </h1>
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br><br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br><br>
        <button type="submit">Log In</button>
         <p>Don't have an account?</p>
    <button type="button" onclick="location.href='/Customer/SignUp.html'">Sign Up</button>
        </form>
        <script>
            // Login handler: attempt server-side customer login, fallback to provider prototype
            (function(){
                const form = document.getElementById('loginForm');
                form.addEventListener('submit', async function(e){
                    e.preventDefault();
                    const fd = new FormData(form);
                    const username = fd.get('username').trim();
                    const password = fd.get('password').trim();
                    if(!username || !password){ alert('Please enter both username and password.'); return; }

                    // First try customer login (server-side)
                    try{
                        const res = await fetch('/api/customers/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ username: username, password: password })
                        });
                        if(res.ok){
                            const customer = await res.json();
                            // store id for later client flows
                            try{ localStorage.setItem('customerId', String(customer.id)); }catch(e){}
                            sessionStorage.setItem('glc_logged_in', 'true');
                            sessionStorage.setItem('glc_user', customer.name || customer.email || username);
                            sessionStorage.setItem('glc_role', 'customer');
                            window.location.href = '/Customer/CustomerHome.html';
                            return;
                        }
                        // otherwise fall through to provider mock handling below
                    }catch(err){
                        console.warn('Customer login request failed, falling back to prototype provider check', err);
                    }

                    // Provider prototype (there is no provider auth endpoint in backend yet)
                    const provider = { username: 'provider', password: 'provider123' };
                    if(username === provider.username && password === provider.password){
                        sessionStorage.setItem('glc_logged_in', 'true');
                        sessionStorage.setItem('glc_user', username);
                        sessionStorage.setItem('glc_role', 'provider');
                        window.location.href = '/Provider/Home.html';
                        return;
                    }

                    alert('Invalid credentials. If you are a customer, ensure your email and password match the database.');
                });
            })();
        </script>
    </div>
</body>
</html>